<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style type="text/css">html {
        height: 100%
    }

    body {
        height: 100%;
        margin: 0;
        padding: 0
    }

    #container {
        height: 100%
    }</style>
    <script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=O1uMKSR3d1GHlmzxrMSvXbTWdRfrwUHR"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/CurveLine/1.5/src/CurveLine.min.js"></script>
    <title>历史轨迹</title>
</head>
<body>
<div id="container"></div>

<script type="text/javascript">

    var opts = {
        width: 200,
        height: 100,
        title: "title",
        enableMessage: true,
        message: "message"
    };
    var r = window.location.search;
    if (r.indexOf("?") > -1) {
        r = r.substring(r.indexOf("?") + 1, r.length);
    }
    var ajson = {
        "scale": 10,
        "center": "118.916812,32.109531",
        "coords": ["118.916812,32.109531", "120.444,32.515", "120.377065,31.488258", "120.530972,31.314192"],
        "infowindow":["地址:1","地址:2"]
    };
    var map = new BMap.Map("container");
    map.enableScrollWheelZoom(true);
    var point = new BMap.Point(ajson.center.split(',')[0], ajson.center.split(',')[1]);
    map.centerAndZoom(point, ajson.scale);
    points = [];
    for (var j = 0; j < ajson.coords.length; j++) {
        var p1 = ajson.coords[j].split(",")[0];
        var p2 = ajson.coords[j].split(",")[1];
        /*var p3 = ajson.coords[j].split(",")[2];
        var p4 = ajson.coords[j].split(",")[3];*/
        points.push(new BMap.Point(p1, p2));
    }
    map.addOverlay(new BMap.Polyline(points, {strokeColor: "blue", strokeWeight: 3, strokeOpacity: 0.5}));
    var m1 = new BMap.Icon("image/marker.png", new BMap.Size(100,100), {
        offset: new BMap.Size(10, 25),
        imageOffset: new BMap.Size(0, 0 - 25)
    });
    var point1 = new BMap.Marker(points[0], {icon: m1});
    map.addOverlay(point1);
//    point1.setAnimation(BMAP_ANIMATION_BOUNCE);
    point1.addEventListener("click", function(){
        map.openInfoWindow(new BMap.InfoWindow(ajson.infowindow[0], opts),point);
    });
    var mi = new BMap.Icon("image/marker.png", new BMap.Size(100,100), {
        offset: new BMap.Size(10, 25),
        imageOffset: new BMap.Size(0, 0 - 25)
    });
    var point2 = new BMap.Marker(points[points.length - 1], {icon: mi});
    map.addOverlay(point2);
//    point2.setAnimation(BMAP_ANIMATION_BOUNCE);
    point2.addEventListener("click", function(){
        map.openInfoWindow(new BMap.InfoWindow(ajson.infowindow[1], opts),new BMap.Point(ajson.coords[points.length - 1].split(",")[0],ajson.coords[points.length - 1].split(",")[1]));
    });
    /*var m2 = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {
        offset: new BMap.Size(10, 25),
        imageOffset: new BMap.Size(0, 0 - 25)
    });
    var point3 = new BMap.Marker(points[2], {icon: m2});
    map.addOverlay(point3);
    point3.setAnimation(BMAP_ANIMATION_BOUNCE);
    point3.addEventListener("click", function(){
        map.openInfoWindow(infoWindow3,new BMap.Point(ajson.coords[2].split(",")[0],ajson.coords[2].split(",")[1]));
    });
    var m3 = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {
        offset: new BMap.Size(10, 25),
        imageOffset: new BMap.Size(0, 0 - 25)
    });
    var point4 = new BMap.Marker(points[3], {icon: m3});
    map.addOverlay(point4);
    point4.setAnimation(BMAP_ANIMATION_BOUNCE);
    point4.addEventListener("click", function(){
        map.openInfoWindow(infoWindow4,new BMap.Point(ajson.coords[3].split(",")[0],ajson.coords[3].split(",")[1]));
    });*/
    var menu = new BMap.ContextMenu();
  /*  function showInfo(e){
        alert(e.point.lng + ", " + e.point.lat);
    }
    map.addEventListener("click", showInfo);*/
    var txtMenuItem = [
        {
            text: '放大',
            callback: function () {
                map.zoomIn()
            }
        },
        {
            text: '缩小',
            callback: function () {
                map.zoomOut()
            }
        },
        {
            text:'在此添加标注',
            callback:function(p){
                var marker = new BMap.Marker(p);
                map.addOverlay(marker);
            }}
    ];
    for (var i = 0; i < txtMenuItem.length; i++) {
        menu.addItem(new BMap.MenuItem(txtMenuItem[i].text, txtMenuItem[i].callback, 100));
    }
    map.addContextMenu(menu);
    var navigationControl = new BMap.NavigationControl({
        anchor: BMAP_ANCHOR_TOP_LEFT,
        type: BMAP_NAVIGATION_CONTROL_LARGE,
        enableGeolocation: true
    });
    map.addControl(navigationControl);
    var geolocationControl = new BMap.GeolocationControl();
    geolocationControl.addEventListener("locationSuccess", function (e) {
        var address = '';
        address += e.addressComponent.province;
        address += e.addressComponent.city;
        address += e.addressComponent.district;
        address += e.addressComponent.street;
        address += e.addressComponent.streetNumber;
        alert("当前定位地址为：" + address);
    });
    geolocationControl.addEventListener("locationError", function (e) {
        alert(e.message);
    });
    map.addControl(geolocationControl);
    point1.addEventListener("click",getAttr);
    function getAttr(){
        var p = point1.getPosition();
        alert("当前位置是" + p.lng + "," + p.lat);
    }
    point2.addEventListener("click",getAttr);
    function getAttr(){
        var p = point2.getPosition();
        alert("当前位置是" + p.lng + "," + p.lat);
    }
</script>
</body>
</html>
