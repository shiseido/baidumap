<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="jquery,ui,easy,easyui,web">
    <meta name="description" content="easyui help you build your web page easily!">
    <title>设备ID</title>
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.net/Public/js/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.net/Public/js/easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="http://www.jeasyui.net/Public/js/easyui/demo/demo.css">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script type="text/javascript" src="http://www.jeasyui.net/Public/js/easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript">
        $(function(){
            $('#tt').datagrid({
                title:'Editable DataGrid',
                iconCls:'icon-edit',
                width:1024,
                height:768,
                singleSelect:true,
                idField:'itemid',
                url:'js/datagrid_data.json',
                columns:[[
                    {field:'productid',title:'设备ID',width:180,editor:'textbox'},
                    {field:'mode',title:'模式',width:100,
                        editor:{
                            type:'checkbox',
                            options:{
                                on: 'ON',
                                off: 'OFF'
                            }
                        }
                        /*editor:{
                            type:'textbox',
                            options:{
                                valueField:'productid',
                                textField:'name',
                                data:products,
                                required:true
                            }
                        }*/

                    },
                    {field:'lat',title:'纬度',width:80,align:'right',editor:{type:'numberbox',options:{precision:6}}},
                    {field:'lon',title:'经度',width:80,align:'right',editor:{type:'numberbox',options:{precision:6}}},
                    {field:'ip',title:'IP地址',width:100,align:'right',editor:{type:'numberbox',options:{precision:6}}},
                    {field:'port',title:'端口',width:80,align:'right',editor:{type:'numberbox',options:{precision:5}}},
                    {field:'time1',title:'连接时间',width:180,align:'right',editor:{type:'numberbox',options:{precision:2}}},
                    {field:'time2',title:'更新时间',width:180,align:'right',editor:{type:'numberbox',options:{precision:2}}},
                    {field:'interval',title:'间隔',width:80,align:'right',editor:{type:'numberbox'}},
                    {
                        field: 'status', title: '状态', width: 100,
                        editor: {
                            type: 'checkbox',
                            options: {
                                on: '在线',
                                off: '离线'
                            }
                        }
                    },
                    {field:'equip',title:'设备信息',width:80,editor:'textbox'},
                    {field:'abnormal',title:'异常码',width:80,editor:'numberbox'},
                    {field:'user',title:'用户',width:80,editor:'textbox'},
                    {field:'Co',title:'公司',width:100,editor:'textbox'},
                    {field:'action',title:'Action',width:80,align:'center',
                        formatter:function(value,row,index){
                            if (row.editing){
                                var s = '<a href="#" onclick="saverow(this)">保存</a> ';
                                var c = '<a href="#" onclick="cancelrow(this)">取消</a>';
                                return s+c;
                            } else {
                                var e = '<a href="#" onclick="editrow(this)"></a> ';
                                var d = '<a href="#" onclick="deleterow(this)">删除</a>';
                                return e+d;
                            }
                        }
                    }
                ]],
                onBeforeEdit:function(index,row){
                    row.editing = true;
                    updateActions(index);
                },
                onAfterEdit:function(index,row){
                    row.editing = false;
                    updateActions(index);
                },
                onCancelEdit:function(index,row){
                    row.editing = false;
                    updateActions(index);
                }
            });
        });
        function updateActions(index){
            $('#tt').datagrid('updateRow',{
                index: index,
                row:{}
            });
        }
        function getRowIndex(target){
            var tr = $(target).closest('tr.datagrid-row');
            return parseInt(tr.attr('datagrid-row-index'));
        }
        function editrow(target){
            $('#tt').datagrid('beginEdit', getRowIndex(target));
        }
        function deleterow(target){
            $.messager.confirm('Confirm','Are you sure?',function(r){
                if (r){
                    $('#tt').datagrid('deleteRow', getRowIndex(target));
                }
            });
        }
        function doSearch(){
            $('#tt').datagrid('load',{
                itemid: $('#itemid').val(),
                productid: $('#productid').val()
            });
        }
        function saverow(target){
            $('#tt').datagrid('endEdit', getRowIndex(target));
        }
        function cancelrow(target){
            $('#tt').datagrid('cancelEdit', getRowIndex(target));
        }
        function insert(){
            var row = $('#tt').datagrid('getSelected');
            if (row){
                var index = $('#tt').datagrid('getRowIndex', row);
            } else {
                index = 0;
            }
            $('#tt').datagrid('insertRow', {
                index: index,
                row:{
                    status:'p'
                }
            });
            $('#tt').datagrid('selectRow',index);
            $('#tt').datagrid('beginEdit',index);
        }
    </script>
</head>
<body>
<h2>设备管理器</h2>
<div style="margin:10px 0">
    <a href="#" class="easyui-linkbutton" onclick="insert()">添加设备</a>
</div>
<div id="tb" style="padding:3px">
    <span>设备ID:</span>
    <input id="itemid" style="line-height:26px;border:1px solid #ccc">
    <span>端口:</span>
    <input id="productid" style="line-height:26px;border:1px solid #ccc">
    <a href="#" class="easyui-linkbutton" plain="true" onclick="doSearch()">查询</a>
</div>
<table id="tt" class="easyui-datagrid" style="width:700px;height:250px"
       url="js/datagrid24_getdata.php"
       title="Searching" iconCls="icon-search" toolbar="#tb"
       rownumbers="true" pagination="true"></table>

</body>
</html>